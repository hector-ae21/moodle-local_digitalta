{"version":3,"file":"modals.min.js","sources":["../../../src/myexperience/view/modals.js"],"sourcesContent":["import Modal from 'core/modal';\r\nimport ModalRegistry from 'core/modal_registry';\r\nimport {getAllResources} from 'local_dta/repositories/resources_repository';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport {upsertContext} from 'local_dta/repositories/context_repository';\r\nimport $ from 'jquery';\r\nimport {SELECTORS} from './main';\r\nimport Notification from 'core/notification';\r\nimport {getCases} from 'local_dta/repositories/ourcases_repository';\r\n\r\nconst linkResourcesModal = class extends Modal {\r\n    static TYPE = 'local_dta/linkResourcesModal';\r\n\r\n    static TEMPLATE = 'local_dta/experiences/view/modal-resources';\r\n\r\n    registerEventListeners() {\r\n        // Call the parent registration.\r\n        super.registerEventListeners();\r\n\r\n        // Register to close on save/cancel.\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\n\r\nModalRegistry.register(linkResourcesModal.TYPE, linkResourcesModal, linkResourcesModal.TEMPLATE);\r\n\r\n\r\nconst linkCasesModal = class extends Modal {\r\n    static TYPE = 'local_dta/linkCasesModal';\r\n\r\n    static TEMPLATE = 'local_dta/experiences/view/modal-cases';\r\n\r\n    registerEventListeners() {\r\n        // Call the parent registration.\r\n        super.registerEventListeners();\r\n\r\n        // Register to close on save/cancel.\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\n\r\nModalRegistry.register(linkCasesModal.TYPE, linkCasesModal, linkCasesModal.TEMPLATE);\r\n\r\n\r\n/**\r\n * Display a modal dialogue.\r\n */\r\nexport const displaylinkResourcesModal = async() => {\r\n    const {resources} = await getAllResources();\r\n\r\n    const modal = await ModalFactory.create({\r\n        type: linkResourcesModal.TYPE,\r\n        templateContext: {elementid_: Date.now(), resources},\r\n        large: true,\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    $root.on(ModalEvents.save, () => {\r\n        handleResourceModal();\r\n    });\r\n};\r\n\r\n\r\n/**\r\n * Handle RESOURCE modal dialogue.\r\n */\r\nconst handleResourceModal = () => {\r\n    const experienceid = $(SELECTORS.INPUTS.experienceid).val();\r\n    const seleccionados = [];\r\n    $(\"#resources-group input[type='checkbox']:checked\").each(function() {\r\n        // Agregar el valor del checkbox seleccionado al array\r\n        seleccionados.push($(this).val());\r\n    });\r\n    const contextid = [];\r\n    seleccionados.forEach(async(resourceid) => {\r\n        contextid.push(\r\n            upsertContext({\r\n                component: \"experience\",\r\n                componentinstance: experienceid,\r\n                modifier: \"resource\",\r\n                modifierinstance: resourceid\r\n            })\r\n        );\r\n    });\r\n\r\n    Promise.all(contextid).then(() => {\r\n        window.location.reload();\r\n        return;\r\n    }).catch((error) => {\r\n        Notification.exception(error);\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * Display a modal dialogue.\r\n */\r\nexport const displaylinkCoursesModal = async() => {\r\n    const {cases} = await getCases();\r\n\r\n    const modal = await ModalFactory.create({\r\n        type: linkCasesModal.TYPE,\r\n        templateContext: {elementid_: Date.now(), cases},\r\n        large: true,\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    $root.on(ModalEvents.save, () => {\r\n        handleCoursesModal();\r\n    });\r\n};\r\n\r\n\r\n/**\r\n * Handle RESOURCE modal dialogue.\r\n */\r\nconst handleCoursesModal = () => {\r\n    const experienceid = $(SELECTORS.INPUTS.experienceid).val();\r\n    const seleccionados = [];\r\n    $(\"#cases-group input[type='checkbox']:checked\").each(function() {\r\n        // Agregar el valor del checkbox seleccionado al array\r\n        seleccionados.push($(this).val());\r\n    });\r\n    const contextid = [];\r\n    // eslint-disable-next-line no-console\r\n    console.log(seleccionados);\r\n    seleccionados.forEach(async(caseid) => {\r\n        contextid.push(\r\n            upsertContext({\r\n                component: \"experience\",\r\n                componentinstance: experienceid,\r\n                modifier: \"case\",\r\n                modifierinstance: caseid\r\n            })\r\n        );\r\n    });\r\n\r\n    Promise.all(contextid).then(() => {\r\n        window.location.reload();\r\n        return;\r\n    }).catch((error) => {\r\n        Notification.exception(error);\r\n    });\r\n\r\n};\r\n"],"names":["linkResourcesModal","Modal","registerEventListeners","registerCloseOnSave","registerCloseOnCancel","register","TYPE","TEMPLATE","linkCasesModal","async","resources","modal","ModalFactory","create","type","templateContext","elementid_","Date","now","large","show","getRoot","on","ModalEvents","save","handleResourceModal","experienceid","SELECTORS","INPUTS","val","seleccionados","each","push","this","contextid","forEach","component","componentinstance","modifier","modifierinstance","resourceid","Promise","all","then","window","location","reload","catch","error","exception","cases","handleCoursesModal","console","log","caseid"],"mappings":"0oCAWMA,2CAAqB,cAAcC,eAKrCC,+BAEUA,8BAGDC,2BACAC,iCAVK,kEAEI,8EAYRC,SAASL,mBAAmBM,KAAMN,mBAAoBA,mBAAmBO,gBAGjFC,wCAAiB,cAAcP,eAKjCC,+BAEUA,8BAGDC,2BACAC,iCAVK,+DAEI,2EAYRC,SAASG,eAAeF,KAAME,eAAgBA,eAAeD,6CAMlCE,gBAC/BC,UAACA,iBAAmB,2CAEpBC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMd,mBAAmBM,KACzBS,gBAAiB,CAACC,WAAYC,KAAKC,MAAOR,UAAAA,WAC1CS,OAAO,IAEXR,MAAMS,OACQT,MAAMU,UACdC,GAAGC,sBAAYC,MAAM,KACvBC,gCAQFA,oBAAsB,WAClBC,cAAe,mBAAEC,gBAAUC,OAAOF,cAAcG,MAChDC,cAAgB,uBACpB,mDAAmDC,MAAK,WAEtDD,cAAcE,MAAK,mBAAEC,MAAMJ,gBAEzBK,UAAY,GAClBJ,cAAcK,SAAQ1B,MAAAA,aAClByB,UAAUF,MACN,qCAAc,CACVI,UAAW,aACXC,kBAAmBX,aACnBY,SAAU,WACVC,iBAAkBC,iBAK9BC,QAAQC,IAAIR,WAAWS,MAAK,KACxBC,OAAOC,SAASC,YAEjBC,OAAOC,8BACOC,UAAUD,4CAQQvC,gBAC7ByC,MAACA,aAAe,mCAEhBvC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMN,eAAeF,KACrBS,gBAAiB,CAACC,WAAYC,KAAKC,MAAOgC,MAAAA,OAC1C/B,OAAO,IAEXR,MAAMS,OACQT,MAAMU,UACdC,GAAGC,sBAAYC,MAAM,KACvB2B,+BAQFA,mBAAqB,WACjBzB,cAAe,mBAAEC,gBAAUC,OAAOF,cAAcG,MAChDC,cAAgB,uBACpB,+CAA+CC,MAAK,WAElDD,cAAcE,MAAK,mBAAEC,MAAMJ,gBAEzBK,UAAY,GAElBkB,QAAQC,IAAIvB,eACZA,cAAcK,SAAQ1B,MAAAA,SAClByB,UAAUF,MACN,qCAAc,CACVI,UAAW,aACXC,kBAAmBX,aACnBY,SAAU,OACVC,iBAAkBe,aAK9Bb,QAAQC,IAAIR,WAAWS,MAAK,KACxBC,OAAOC,SAASC,YAEjBC,OAAOC,8BACOC,UAAUD"}