define("local_dta/myexperience/manageReactions",["exports","jquery","core/notification","core/templates","local_dta/repositories/reactions_repository","./selectors"],(function(_exports,_jquery,_notification,_templates,_reactions_repository,_selectors){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function toggle(experienceid){let reaction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const reactionSelectors={1:_selectors.SELECTORS.BUTTONS.likes,0:_selectors.SELECTORS.BUTTONS.dislikes},isActive=(0,_jquery.default)(reactionSelectors[reaction]+_selectors.SELECTORS.DATA.id(experienceid)).hasClass("active"),action=isActive?null:reaction;(0,_reactions_repository.toogleLikeAndDislike)({id:experienceid,action:action,type:1}).then((response=>updateReactionsUI(experienceid,response.likes,response.dislikes,action))).fail(_notification.default.exception)}function updateReactionsUI(experienceid,likes,dislikes,reaction){const reactionSelectors={1:_selectors.SELECTORS.BUTTONS.likes,0:_selectors.SELECTORS.BUTTONS.dislikes};(0,_jquery.default)(_selectors.SELECTORS.BUTTONS.likes+_selectors.SELECTORS.DATA.id(experienceid)).removeClass("active"),(0,_jquery.default)(_selectors.SELECTORS.BUTTONS.dislikes+_selectors.SELECTORS.DATA.id(experienceid)).removeClass("active"),reactionSelectors.hasOwnProperty(reaction)&&(0,_jquery.default)(reactionSelectors[reaction]+_selectors.SELECTORS.DATA.id(experienceid)).addClass("active");const likesText=likes||"";(0,_jquery.default)(_selectors.SELECTORS.DATA.id(experienceid)+_selectors.SELECTORS.COUNTS.likes).text(likesText)}function sendComment(){const comment=(0,_jquery.default)(_selectors.SELECTORS.COMMENT_INPUT).val().trim(),experienceid=(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.sendComment).data("id");comment&&((0,_reactions_repository.saveComment)({experienceid:experienceid,comment:comment}).then((response=>response.result?updateCommentsUI():_notification.default.exception(response))).fail(_notification.default.exception),(0,_jquery.default)(_selectors.SELECTORS.COMMENT_INPUT).val(""))}function updateCommentsUI(){const experienceid=(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.sendComment).data("id");experienceid&&(0,_reactions_repository.getComments)({experienceid:experienceid}).then((response=>{const comments=response.comments.map((comment=>({comment:comment.comment,userfullname:comment.user.fullname})));_templates.default.render("local_dta/experiences/comments",{comments:comments}).then((html=>{(0,_jquery.default)(_selectors.SELECTORS.COMMENTS_LIST).html(html)})),(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.viewComment+_selectors.SELECTORS.DATA.id(experienceid)+" span").text(response.comments.length)})).fail(_notification.default.exception)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init=()=>{(0,_jquery.default)(document).on("click",_selectors.SELECTORS.ACTIONS.addLike,(function(){toggle((0,_jquery.default)(this).data("id"),1)})),(0,_jquery.default)(document).on("click",_selectors.SELECTORS.ACTIONS.addDislike,(function(){toggle((0,_jquery.default)(this).data("id"),0)})),(0,_jquery.default)(document).on("click",_selectors.SELECTORS.ACTIONS.sendComment,sendComment),(0,_jquery.default)(document).on("click",_selectors.SELECTORS.ACTIONS.viewComment,updateCommentsUI),updateCommentsUI()}}));

//# sourceMappingURL=manageReactions.min.js.map