define("local_digitalta/tiny/manage",["exports","editor_tiny/editor","local_digitalta/tiny/cleaner","core/notification","../files/filemanager","../repositories/files_repository"],(function(_exports,_editor,_cleaner,_notification,_filemanager,_files_repository){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.removeTinyMCEFromArea=_exports.processFiles=_exports.getTinyMCEContent=_exports.createTinyMCE=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};_exports.createTinyMCE=elementId=>{const options=window.digitalta_tiny_config;options&&(0,_editor.setupForElementId)({elementId:elementId,options:options}).then((()=>{(0,_cleaner.clean)()})).catch((error=>{_notification.default.exception(error)}))};_exports.processFiles=async content=>{const baseUrl=M.cfg.wwwroot.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),draftFilePattern=new RegExp("(".concat(baseUrl,'\\/draftfile\\.php\\/\\d+\\/user\\/draft\\/(\\d+)\\/[^"?]+)\n'),"g"),matches=Array.from(content.matchAll(draftFilePattern));for(const match of matches){const fullUrl=match[1],draftid=match[2],filename=match[2],fileid=(0,_filemanager.generateFileHash)(filename),response=await(0,_files_repository.filesUploadFromDraft)({draftid:draftid,fileid:fileid,filearea:"local_digitalta"});if(!response.result)throw new Error(response.error||"Error uploading file");content=content.replace(new RegExp(fullUrl,"g"),response.url)}return content};_exports.removeTinyMCEFromArea=area=>{window.tinyMCE.get(area).remove()};_exports.getTinyMCEContent=area=>window.tinyMCE.get(area).getContent()}));

//# sourceMappingURL=manage.min.js.map