{"version":3,"file":"manageReactions.min.js","sources":["../../src/ourcases/manageReactions.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport Notification from \"core/notification\";\r\nimport Template from \"core/templates\";\r\nimport {toogleLikeAndDislike, saveComment, getComments} from \"local_dta/repositories/reactionsRepository\";\r\nimport {SELECTORS} from \"../myexperience/selectors\";\r\n\r\n/**\r\n * Toggle the like and dislike buttons.\r\n * @param {number} caseid - The id of the case.\r\n * @param {number} reaction - The reaction to add. 1 for like, 0 for dislike.\r\n */\r\nfunction toggle(caseid, reaction = null) {\r\n    const reactionSelectors = {\r\n        '1': SELECTORS.BUTTONS.likes,\r\n        '0': SELECTORS.BUTTONS.dislikes,\r\n    };\r\n    const isActive = $(reactionSelectors[reaction] + SELECTORS.DATA.id(caseid)).hasClass(\"active\");\r\n    const action = isActive ? null : reaction;\r\n    toogleLikeAndDislike({id: caseid, action, type: 0})\r\n        .then((response) => {\r\n            return updateReactionsUI(caseid, response.likes, response.dislikes, action);\r\n        })\r\n        .fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Update the like and dislike buttons in the UI.\r\n * @param {number} caseid - The id of the case.\r\n * @param {number} likes - The number of likes.\r\n * @param {number} dislikes - The number of dislikes.\r\n * @param {number} reaction - The reaction to add. 1 for like, 0 for dislike.\r\n * @return {void}\r\n */\r\nfunction updateReactionsUI(caseid, likes, dislikes, reaction) {\r\n    const reactionSelectors = {\r\n        '1': SELECTORS.BUTTONS.likes,\r\n        '0': SELECTORS.BUTTONS.dislikes,\r\n    };\r\n\r\n    $(SELECTORS.BUTTONS.likes + SELECTORS.DATA.id(caseid)).removeClass(\"active\");\r\n    $(SELECTORS.BUTTONS.dislikes + SELECTORS.DATA.id(caseid)).removeClass(\"active\");\r\n\r\n    if (reactionSelectors.hasOwnProperty(reaction)) {\r\n        $(reactionSelectors[reaction] + SELECTORS.DATA.id(caseid)).addClass(\"active\");\r\n    }\r\n\r\n    const likesText = likes ? likes : \"\";\r\n    $(SELECTORS.DATA.id(caseid) + SELECTORS.COUNTS.likes).text(likesText);\r\n}\r\n\r\n/**\r\n * Send the comment to the server.\r\n * @return {void}\r\n */\r\nfunction sendComment() {\r\n    const comment = $(SELECTORS.COMMENT_INPUT).val().trim();\r\n    const caseid = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\r\n\r\n    if (comment) {\r\n        saveComment({caseid, comment})\r\n            .then((response) => {\r\n                if (response.result) {\r\n                    return updateCommentsUI();\r\n                }\r\n                return Notification.exception(response);\r\n            })\r\n            .fail(Notification.exception);\r\n        $(SELECTORS.COMMENT_INPUT).val(\"\");\r\n    }\r\n}\r\n\r\n/**\r\n * Update the comments in the UI.\r\n * @return {void}\r\n */\r\nasync function updateCommentsUI() {\r\n    const caseid = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\r\n    if (!caseid) {\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const response = await getComments({caseid});\r\n        const comments = response.comments.map((comment) => ({\r\n            comment: comment.comment,\r\n            userfullname: comment.user.fullname,\r\n        }));\r\n\r\n        await Template.render(\"local_dta/experiences/comments\", {comments})\r\n            .then((html) => {\r\n                $(SELECTORS.COMMENTS_LIST).html(html);\r\n                return;\r\n            })\r\n            .catch(Notification.exception);\r\n\r\n        $(SELECTORS.ACTIONS.viewComment + SELECTORS.DATA.id(caseid) + \" span\").text(response.comments.length);\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n}\r\n\r\n/**\r\n * Set the events for the module.\r\n * @return {void}\r\n */\r\nfunction setEvents() {\r\n    $(document).on(\"click\", SELECTORS.ACTIONS.addLike, function() {\r\n        toggle($(this).data(\"id\"), 1);\r\n    });\r\n    $(document).on(\"click\", SELECTORS.ACTIONS.addDislike, function() {\r\n        toggle($(this).data(\"id\"), 0);\r\n    });\r\n    $(document).on(\"click\", SELECTORS.ACTIONS.sendComment, sendComment);\r\n    $(document).on(\"click\", SELECTORS.ACTIONS.viewComment, updateCommentsUI);\r\n}\r\n\r\nexport const init = () => {\r\n    setEvents();\r\n    updateCommentsUI();\r\n};"],"names":["toggle","caseid","reaction","reactionSelectors","SELECTORS","BUTTONS","likes","dislikes","isActive","DATA","id","hasClass","action","type","then","response","updateReactionsUI","fail","Notification","exception","removeClass","hasOwnProperty","addClass","likesText","COUNTS","text","sendComment","comment","COMMENT_INPUT","val","trim","ACTIONS","data","result","updateCommentsUI","comments","map","userfullname","user","fullname","Template","render","html","COMMENTS_LIST","catch","viewComment","length","error","document","on","addLike","this","addDislike"],"mappings":"+VAWSA,OAAOC,YAAQC,gEAAW,WACzBC,kBAAoB,GACjBC,qBAAUC,QAAQC,QAClBF,qBAAUC,QAAQE,UAErBC,UAAW,mBAAEL,kBAAkBD,UAAYE,qBAAUK,KAAKC,GAAGT,SAASU,SAAS,UAC/EC,OAASJ,SAAW,KAAON,uDACZ,CAACQ,GAAIT,OAAQW,OAAAA,OAAQC,KAAM,IAC3CC,MAAMC,UACIC,kBAAkBf,OAAQc,SAAST,MAAOS,SAASR,SAAUK,UAEvEK,KAAKC,sBAAaC,oBAWlBH,kBAAkBf,OAAQK,MAAOC,SAAUL,gBAC1CC,kBAAoB,GACjBC,qBAAUC,QAAQC,QAClBF,qBAAUC,QAAQE,8BAGzBH,qBAAUC,QAAQC,MAAQF,qBAAUK,KAAKC,GAAGT,SAASmB,YAAY,8BACjEhB,qBAAUC,QAAQE,SAAWH,qBAAUK,KAAKC,GAAGT,SAASmB,YAAY,UAElEjB,kBAAkBkB,eAAenB,+BAC/BC,kBAAkBD,UAAYE,qBAAUK,KAAKC,GAAGT,SAASqB,SAAS,gBAGlEC,UAAYjB,OAAgB,uBAChCF,qBAAUK,KAAKC,GAAGT,QAAUG,qBAAUoB,OAAOlB,OAAOmB,KAAKF,oBAOtDG,oBACCC,SAAU,mBAAEvB,qBAAUwB,eAAeC,MAAMC,OAC3C7B,QAAS,mBAAEG,qBAAU2B,QAAQL,aAAaM,KAAK,MAEjDL,+CACY,CAAC1B,OAAAA,OAAQ0B,QAAAA,UAChBb,MAAMC,UACCA,SAASkB,OACFC,mBAEJhB,sBAAaC,UAAUJ,YAEjCE,KAAKC,sBAAaC,+BACrBf,qBAAUwB,eAAeC,IAAI,oBAQxBK,yBACLjC,QAAS,mBAAEG,qBAAU2B,QAAQL,aAAaM,KAAK,SAChD/B,iBAKKc,eAAiB,oCAAY,CAACd,OAAAA,SAC9BkC,SAAWpB,SAASoB,SAASC,KAAKT,WACpCA,QAASA,QAAQA,QACjBU,aAAcV,QAAQW,KAAKC,mBAGzBC,mBAASC,OAAO,iCAAkC,CAACN,SAAAA,WACpDrB,MAAM4B,2BACDtC,qBAAUuC,eAAeD,KAAKA,SAGnCE,MAAM1B,sBAAaC,+BAEtBf,qBAAU2B,QAAQc,YAAczC,qBAAUK,KAAKC,GAAGT,QAAU,SAASwB,KAAKV,SAASoB,SAASW,QAChG,MAAOC,6BACQ5B,UAAU4B,6OAmBX,yBAVdC,UAAUC,GAAG,QAAS7C,qBAAU2B,QAAQmB,SAAS,WAC/ClD,QAAO,mBAAEmD,MAAMnB,KAAK,MAAO,0BAE7BgB,UAAUC,GAAG,QAAS7C,qBAAU2B,QAAQqB,YAAY,WAClDpD,QAAO,mBAAEmD,MAAMnB,KAAK,MAAO,0BAE7BgB,UAAUC,GAAG,QAAS7C,qBAAU2B,QAAQL,YAAaA,iCACrDsB,UAAUC,GAAG,QAAS7C,qBAAU2B,QAAQc,YAAaX,kBAKvDA"}