{"version":3,"file":"modals.min.js","sources":["../../../src/myexperience/view/modals.js"],"sourcesContent":["import Modal from \"core/modal\";\nimport ModalRegistry from \"core/modal_registry\";\nimport { getAllResources } from \"local_dta/repositories/resources_repository\";\nimport ModalFactory from \"core/modal_factory\";\nimport ModalEvents from \"core/modal_events\";\nimport { upsertContext } from \"local_dta/repositories/context_repository\";\nimport $ from \"jquery\";\nimport { SELECTORS } from \"./main\";\nimport Notification from \"core/notification\";\nimport { getCases } from \"local_dta/repositories/ourcases_repository\";\nimport {displayDialogue} from \"local_dta/resources/manage_resources\";\n\nconst linkResourcesModal = class extends Modal {\n  static TYPE = \"local_dta/linkResourcesModal\";\n\n  static TEMPLATE = \"local_dta/experiences/view/modal-resources\";\n\n  registerEventListeners() {\n    // Call the parent registration.\n    super.registerEventListeners();\n\n    // Register to close on save/cancel.\n    this.registerCloseOnSave();\n    this.registerCloseOnCancel();\n  }\n};\n\nModalRegistry.register(linkResourcesModal.TYPE, linkResourcesModal, linkResourcesModal.TEMPLATE);\n\nconst linkCasesModal = class extends Modal {\n  static TYPE = \"local_dta/linkCasesModal\";\n\n  static TEMPLATE = \"local_dta/experiences/view/modal-cases\";\n\n  registerEventListeners() {\n    // Call the parent registration.\n    super.registerEventListeners();\n\n    // Register to close on save/cancel.\n    this.registerCloseOnSave();\n    this.registerCloseOnCancel();\n  }\n};\n\nModalRegistry.register(linkCasesModal.TYPE, linkCasesModal, linkCasesModal.TEMPLATE);\n\n/**\n * Display a modal dialogue.\n * @param {boolean} change\n */\nexport const displaylinkResourcesModal = async (change) => {\n  const { resources } = await getAllResources();\n\n  const modal = await ModalFactory.create({\n    type: linkResourcesModal.TYPE,\n    templateContext: { elementid_: Date.now(), resources, change: change},\n    large: true,\n  });\n  modal.show();\n  const $root = modal.getRoot();\n  if (change) {\n    const changeElement = $root.find(\"#changeToAddResource\").get(0);\n    if (changeElement) {\n      changeElement.onclick = () => {\n        displayDialogue(true);\n        modal.hide();\n      };\n    }\n  }\n  $root.on(ModalEvents.save, () => {\n    handleResourceModal();\n  });\n};\n\n/**\n * Handle RESOURCE modal dialogue.\n */\nconst handleResourceModal = () => {\n  const experienceid = $(SELECTORS.INPUTS.experienceid).val();\n  const seleccionados = [];\n  $(\"#resources-group input[type='checkbox']:checked\").each(function () {\n    // Agregar el valor del checkbox seleccionado al array\n    seleccionados.push($(this).val());\n  });\n  const contextid = [];\n  seleccionados.forEach(async (resourceid) => {\n    contextid.push(\n      upsertContext({\n        component: \"experience\",\n        componentinstance: experienceid,\n        modifier: \"resource\",\n        modifierinstance: resourceid,\n      })\n    );\n  });\n\n  Promise.all(contextid)\n    .then(() => {\n      window.location.reload();\n      return;\n    })\n    .catch((error) => {\n      Notification.exception(error);\n    });\n};\n\n/**\n * Display a modal dialogue.\n */\nexport const displaylinkCoursesModal = async () => {\n  const { cases } = await getCases();\n\n  const modal = await ModalFactory.create({\n    type: linkCasesModal.TYPE,\n    templateContext: { elementid_: Date.now(), cases },\n    large: true,\n  });\n  modal.show();\n  const $root = modal.getRoot();\n  $root.on(ModalEvents.save, () => {\n    handleCoursesModal();\n  });\n};\n\n/**\n * Handle RESOURCE modal dialogue.\n */\nconst handleCoursesModal = () => {\n  const experienceid = $(SELECTORS.INPUTS.experienceid).val();\n  const seleccionados = [];\n  $(\"#cases-group input[type='checkbox']:checked\").each(function () {\n    // Agregar el valor del checkbox seleccionado al array\n    seleccionados.push($(this).val());\n  });\n  const contextid = [];\n  // eslint-disable-next-line no-console\n  console.log(seleccionados);\n  seleccionados.forEach(async (caseid) => {\n    contextid.push(\n      upsertContext({\n        component: \"experience\",\n        componentinstance: experienceid,\n        modifier: \"case\",\n        modifierinstance: caseid,\n      })\n    );\n  });\n\n  Promise.all(contextid)\n    .then(() => {\n      window.location.reload();\n      return;\n    })\n    .catch((error) => {\n      Notification.exception(error);\n    });\n};\n"],"names":["linkResourcesModal","Modal","registerEventListeners","registerCloseOnSave","registerCloseOnCancel","register","TYPE","TEMPLATE","linkCasesModal","async","resources","modal","ModalFactory","create","type","templateContext","elementid_","Date","now","change","large","show","$root","getRoot","changeElement","find","get","onclick","hide","on","ModalEvents","save","handleResourceModal","experienceid","SELECTORS","INPUTS","val","seleccionados","each","push","this","contextid","forEach","component","componentinstance","modifier","modifierinstance","resourceid","Promise","all","then","window","location","reload","catch","error","exception","cases","handleCoursesModal","console","log","caseid"],"mappings":"msCAYMA,2CAAqB,cAAcC,eAKvCC,+BAEQA,8BAGDC,2BACAC,iCAVO,kEAEI,8EAYNC,SAASL,mBAAmBM,KAAMN,mBAAoBA,mBAAmBO,gBAEjFC,wCAAiB,cAAcP,eAKnCC,+BAEQA,8BAGDC,2BACAC,iCAVO,+DAEI,2EAYNC,SAASG,eAAeF,KAAME,eAAgBA,eAAeD,6CAMlCE,MAAAA,eACjCC,UAAEA,iBAAoB,2CAEtBC,YAAcC,uBAAaC,OAAO,CACtCC,KAAMd,mBAAmBM,KACzBS,gBAAiB,CAAEC,WAAYC,KAAKC,MAAOR,UAAAA,UAAWS,OAAQA,QAC9DC,OAAO,IAETT,MAAMU,aACAC,MAAQX,MAAMY,aAChBJ,OAAQ,OACJK,cAAgBF,MAAMG,KAAK,wBAAwBC,IAAI,GACzDF,gBACFA,cAAcG,QAAU,4CACN,GAChBhB,MAAMiB,SAIZN,MAAMO,GAAGC,sBAAYC,MAAM,KACzBC,gCAOEA,oBAAsB,WACpBC,cAAe,mBAAEC,gBAAUC,OAAOF,cAAcG,MAChDC,cAAgB,uBACpB,mDAAmDC,MAAK,WAExDD,cAAcE,MAAK,mBAAEC,MAAMJ,gBAEvBK,UAAY,GAClBJ,cAAcK,SAAQjC,MAAAA,aACpBgC,UAAUF,MACR,qCAAc,CACZI,UAAW,aACXC,kBAAmBX,aACnBY,SAAU,WACVC,iBAAkBC,iBAKxBC,QAAQC,IAAIR,WACTS,MAAK,KACJC,OAAOC,SAASC,YAGjBC,OAAOC,8BACOC,UAAUD,4CAOU9C,gBAC/BgD,MAAEA,aAAgB,mCAElB9C,YAAcC,uBAAaC,OAAO,CACtCC,KAAMN,eAAeF,KACrBS,gBAAiB,CAAEC,WAAYC,KAAKC,MAAOuC,MAAAA,OAC3CrC,OAAO,IAETT,MAAMU,OACQV,MAAMY,UACdM,GAAGC,sBAAYC,MAAM,KACzB2B,+BAOEA,mBAAqB,WACnBzB,cAAe,mBAAEC,gBAAUC,OAAOF,cAAcG,MAChDC,cAAgB,uBACpB,+CAA+CC,MAAK,WAEpDD,cAAcE,MAAK,mBAAEC,MAAMJ,gBAEvBK,UAAY,GAElBkB,QAAQC,IAAIvB,eACZA,cAAcK,SAAQjC,MAAAA,SACpBgC,UAAUF,MACR,qCAAc,CACZI,UAAW,aACXC,kBAAmBX,aACnBY,SAAU,OACVC,iBAAkBe,aAKxBb,QAAQC,IAAIR,WACTS,MAAK,KACJC,OAAOC,SAASC,YAGjBC,OAAOC,8BACOC,UAAUD"}